<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medicine Viewer</title>
  <style>
    /* --- Basic layout --- */
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: Arial, sans-serif;
      background: #fafafa;
    }
    #sidebar {
      width: 220px;
      padding: 10px;
      background: #f0f0f0;
      overflow-y: auto;
      box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
    }
    #content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #fff;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
    }

    /* --- Search box --- */
    #search {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    /* --- Buttons --- */
    .med-btn {
      width: 100%;
      padding: 8px;
      margin-bottom: 6px;
      border: none;
      border-radius: 4px;
      background: #6c63ff;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    .med-btn:hover {
      background: #5753c9;
    }

    /* --- Content section --- */
    h2 { margin-top: 0; }
    .category {
      margin-bottom: 18px;
    }
    .category h3 {
      margin: 6px 0;
    }
    ul {
      padding-left: 20px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <!-- Sidebar for medicine list -->
  <div id="sidebar">
    <input type="text" id="search" placeholder="Search...">
  </div>

  <!-- Main area for details -->
  <div id="content"><p>Select a medicine from the left side.</p></div>

  <script>
    /*------------- CONFIG -------------*/
    // Predefined list of medicine files (without .json extension)
    const medFiles = [
        'Fluoxetine',
        'Paracetamol',
        // Add other medicine names here
    ];

    /*------------- HELPERS -------------*/
    const sidebar = document.getElementById("sidebar");
    const content = document.getElementById("content");
    const searchInput = document.getElementById("search");
    const medSynonyms = {}; // {medName: [list of trade names]}

    function initializeMedicines() {
        medFiles.forEach(makeButton);
        searchInput.addEventListener('input', filterMedicines);
        preloadSynonyms();
    }

    function cap(str) { return str.charAt(0).toUpperCase() + str.slice(1); }

    function makeButton(name) {
      const btn = document.createElement("button");
      btn.textContent = cap(name);
      btn.className = "med-btn";
      btn.dataset.med = name.toLowerCase();
      btn.addEventListener("click", () => loadMedicine(name));
      sidebar.appendChild(btn);
    }

    function preloadSynonyms() {
      medFiles.forEach(name => {
        fetch(`Medicine/${name}.json`)
          .then(r => r.json())
          .then(json => {
            const key = Object.keys(json)[0];
            const med = json[key][0];
            const list = [];
            ["liquid", "tablet", "other"].forEach(cat => {
              (med[cat] || []).forEach(item => list.push(item.toLowerCase()));
            });
            medSynonyms[name.toLowerCase()] = list;
          })
          .catch(err => console.error('Error loading ' + name, err));
      });
    }

    function filterMedicines() {
      const term = searchInput.value.toLowerCase();
      document.querySelectorAll('.med-btn').forEach(btn => {
        const name = btn.dataset.med;
        const syns = medSynonyms[name] || [];
        const matchName = name.includes(term);
        const matchSyn = syns.some(s => s.includes(term));
        btn.style.display = matchName || matchSyn ? '' : 'none';
      });
    }

    /*------------- LOAD & RENDER -------------*/
    function loadMedicine(name) {
        fetch(`Medicine/${name}.json`)
            .then(r => {
                if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
                return r.json();
            })
            .then(json => {
                const firstKey = Object.keys(json)[0];
                const med = json[firstKey][0];
                showMedicine(med);
            })
            .catch(err => {
                console.error('Error loading medicine:', err);
                content.innerHTML = `<p style='color:red'>Error loading ${name}.json</p>`;
            });
    }

    function showMedicine(m) {
      content.innerHTML = "";

      const title = document.createElement("h2");
      title.textContent = m.name;
      content.appendChild(title);

      const goal = document.createElement("p");
      goal.textContent = "Goal: " + m.goal;
      content.appendChild(goal);

      ["liquid", "tablet", "other"].forEach(cat => {
        if (m[cat] && m[cat].length) {
          const section = document.createElement("div");
          section.className = "category";

          const h3 = document.createElement("h3");
          h3.textContent = cap(cat);
          section.appendChild(h3);

          const ul = document.createElement("ul");
          m[cat].forEach(item => {
            const li = document.createElement("li");
            li.textContent = item;
            ul.appendChild(li);
          });
          section.appendChild(ul);
          content.appendChild(section);
        }
      });
    }

    function loadReadme() {
      fetch('README.md')
        .then(r => r.text())
        .then(text => {
          content.innerHTML = marked.parse(text);
        })
        .catch(err => {
          console.error('Error loading README:', err);
          content.textContent = 'README could not be loaded.';
        });
    }

    /*------------- INIT -------------*/
    initializeMedicines(); // Initialize sidebar buttons
    loadReadme(); // Show README on startup
  </script>
</body>
</html>